<style>

</style>
<template id="app_inside">
    <div class="fully">
        <div class="mt-4">
            <el-form :model="reg_form" :rules="rules" ref="reg_form" label-width="110px" class="demo-dynamic">
                <el-row :gutter="20">
                    <el-col :span="16">
                        <el-form-item label="注册类型" prop="type">
                            <el-select v-model="reg_form.type" @change="change_type(reg_form.type)" placeholder="请选择注册类型">
                                <el-option label="个人志愿者" value="1"></el-option>
                                <el-option label="单位志愿者" value="2"></el-option>
                            </el-select>
                        </el-form-item>
                    </el-col>
                    <el-col :span="8">
                        <div class="f20 ">欢迎注册协会者志愿者</div>
                    </el-col>
                </el-row>
                <template v-if="reg_form.type ==2">
                    <el-row :gutter="20">
                        <el-col :span="12">
                            <el-form-item label="单位名称" prop="c_name">
                                <el-input v-model="reg_form.c_name"></el-input>
                            </el-form-item>
                        </el-col>
                        <el-col :span="12">
                            <el-form-item label="统一社会信用代码" label-width="140px" prop="c_credit_code">
                                <el-input v-model="reg_form.c_credit_code"></el-input>
                            </el-form-item>
                        </el-col>
                    </el-row>

                    <el-row :gutter="20">
                        <el-col :span="8">
                            <el-form-item label="注册资本" prop="c_capital">
                                <el-input v-model="reg_form.c_capital"></el-input>
                            </el-form-item>
                        </el-col>

                        <el-col :span="8">
                            <el-form-item label="单位类型" prop="c_unit_type">
                                <el-select v-model="reg_form.c_unit_type" placeholder="请选择单位类型">
                                    <el-option label="代理记账行业协会" value="代理记账行业协会"></el-option>
                                    <el-option label="代理记账机构" value="代理记账机构"></el-option>
                                    <el-option label="财经类院校" value="财经类院校"></el-option>
                                    <el-option label="其他" value="其他"></el-option>
                                </el-select>
                            </el-form-item>
                        </el-col>

                        <el-col :span="8">
                            <el-form-item label="成立日期">
                                <el-form-item prop="c_found_time">
                                    <el-date-picker type="date" placeholder="选择日期" v-model="reg_form.c_found_time"
                                        value-format="timestamp" style="width: 100%;"></el-date-picker>
                                </el-form-item>
                            </el-form-item>
                        </el-col>
                    </el-row>

                    <el-row :gutter="20">
                        <el-col :span="12">
                            <el-form-item label="省市区" prop="selectedOptions">
                                <el-cascader :options="options" :props="props" v-model="reg_form.selectedOptions" style="width:400px;"></el-cascader>
                            </el-form-item>
                        </el-col>
                        <el-col :span="12">
                            <el-form-item label="电子邮箱" prop="c_email">
                                <el-input v-model="reg_form.c_email"></el-input>
                            </el-form-item>
                        </el-col>
                    </el-row>

                    <el-row>
                        <el-col :span="24">
                            <el-form-item label="实际办公地址" prop="address">
                                <el-input v-model="reg_form.address"></el-input>
                            </el-form-item>
                        </el-col>
                    </el-row>

                    <el-row :gutter="20">
                        <el-col :span="8">
                            <el-form-item label="单位职工数量" prop="c_workers_number">
                                <el-input v-model="reg_form.c_workers_number"></el-input>
                            </el-form-item>
                        </el-col>
                        <el-col :span="8">
                            <el-form-item label="专职会计数量" prop="c_accounting_number">
                                <el-input v-model="reg_form.c_accounting_number"></el-input>
                            </el-form-item>
                        </el-col>
                        <el-col :span="8">
                            <el-form-item label="服务客户数量" prop="c_customer_number">
                                <el-input v-model="reg_form.c_customer_number"></el-input>
                            </el-form-item>
                        </el-col>
                    </el-row>

                    <el-row :gutter="20">
                        <el-col :span="8">
                            <el-form-item label="单位法人" prop="c_legal_person">
                                <el-input v-model="reg_form.c_legal_person"></el-input>
                            </el-form-item>
                        </el-col>
                        <el-col :span="8">
                            <el-form-item label="法人身份证" prop="c_legal_person_idnumber">
                                <el-input v-model="reg_form.c_legal_person_idnumber"></el-input>
                            </el-form-item>
                        </el-col>
                        <el-col :span="8">
                            <el-form-item label="联系方式" prop="c_legal_person_phone">
                                <el-input v-model="reg_form.c_legal_person_phone"></el-input>
                            </el-form-item>
                        </el-col>
                    </el-row>

                    <el-row :gutter="20">
                        <el-col :span="8">
                            <el-form-item label="联络人" prop="c_liaison_person">
                                <el-input v-model="reg_form.c_liaison_person"></el-input>
                            </el-form-item>
                        </el-col>
                        <el-col :span="8">
                            <el-form-item label="联系方式" prop="c_liaison_person_phone">
                                <el-input v-model="reg_form.c_liaison_person_phone"></el-input>
                            </el-form-item>
                        </el-col>
                        <el-col :span="8">
                            <el-form-item label="微信" prop="c_liaison_person_wx">
                                <el-input v-model="reg_form.c_liaison_person_wx"></el-input>
                            </el-form-item>
                        </el-col>
                    </el-row>
                    <!-- <el-row :gutter="20">
                        <el-col :span="12">
                            <el-form-item label="代账业务收入" prop="c_service_income">
                                <el-input v-model="reg_form.c_service_income"></el-input>
                            </el-form-item>
                        </el-col>
                        <el-col :span="12">
                            <el-form-item label="上年度经营收入" label-width="120px" prop="c_lastyear_income">
                                <el-input v-model="reg_form.c_lastyear_income"></el-input>
                            </el-form-item>
                        </el-col>
                    </el-row> -->

                    <el-row :gutter="20">
                        <el-col :span="12">
                            <el-form-item label="服务经历">
                                <el-form-item label="是否登记注册过志愿者" label-width="200px" prop="c_regd">
                                    <el-radio-group v-model="reg_form.c_regd">
                                        <el-radio label="是"></el-radio>
                                        <el-radio label="否"></el-radio>
                                    </el-radio-group>
                                </el-form-item>
                        </el-col>
                        <el-col :span="12">
                            <el-form-item label="志愿者名称" prop="c_regd_name">
                                <el-input v-model="reg_form.c_regd_name"></el-input>
                            </el-form-item>
                        </el-col>
                    </el-row>

                    <el-row :gutter="20">
                        <el-col :span="24">
                            <el-form-item label="业务范围" prop="c_business_range">
                                <el-input type="textarea" v-model="reg_form.c_business_range"></el-input>
                            </el-form-item>
                        </el-col>
                    </el-row>

                    <!-- <el-row :gutter="20">
                        <el-col :span="24">
                            <el-form-item label="承诺内容" prop="c_promise">
                                <el-input type="textarea" v-model="reg_form.c_promise" disabled></el-input>
                            </el-form-item>
                        </el-col>
                    </el-row> -->

                    <el-row :gutter="20">
                        <el-col :span="24">
                            <el-form-item label="自愿提供的服务内容" prop="c_service_content">
                                <el-input type="textarea" v-model="reg_form.c_service_content"></el-input>
                            </el-form-item>
                        </el-col>
                    </el-row>



                </template>

                <template v-if="reg_form.type ==1">
                    <el-row :gutter="20">
                        <el-col :span="8">
                            <el-form-item label="姓名" prop="p_name">
                                <el-input v-model="reg_form.p_name"></el-input>
                            </el-form-item>
                        </el-col>
                        <el-col :span="8">
                            <el-form-item label="性别" prop="p_sex">
                                <el-select v-model="reg_form.p_sex" placeholder="请选择性别">
                                    <el-option label="男" value="男"></el-option>
                                    <el-option label="女" value="女"></el-option>
                                </el-select>
                            </el-form-item>
                        </el-col>
                        <el-col :span="8">
                            <el-form-item label="民族" prop="p_nationality">
                                <el-input v-model="reg_form.p_nationality"></el-input>
                            </el-form-item>
                        </el-col>
                    </el-row>

                    <el-row :gutter="20">
                        <el-col :span="8">
                            <el-form-item label="联系方式" prop="p_phone">
                                <el-input v-model="reg_form.p_phone"></el-input>
                            </el-form-item>
                        </el-col>
                        <el-col :span="8">
                            <el-form-item label="教育程度" prop="p_education">
                                <el-input v-model="reg_form.p_education"></el-input>
                            </el-form-item>
                        </el-col>
                        <el-col :span="8">
                            <el-form-item label="身份证号" prop="p_id_number">
                                <el-input v-model="reg_form.p_id_number"></el-input>
                            </el-form-item>
                        </el-col>
                    </el-row>

                    <el-row :gutter="20">
                        <el-col :span="8">
                            <el-form-item label="专业" prop="p_major">
                                <el-input v-model="reg_form.p_major"></el-input>
                            </el-form-item>
                        </el-col>
                        <el-col :span="8">
                            <el-form-item label="职务" prop="p_job">
                                <el-input v-model="reg_form.p_job"></el-input>
                            </el-form-item>
                        </el-col>
                        <el-col :span="8">
                            <el-form-item label="微信号" prop="p_wx">
                                <el-input v-model="reg_form.p_wx"></el-input>
                            </el-form-item>
                        </el-col>
                    </el-row>

                    <el-row :gutter="20">
                        <el-col :span="16">
                            <el-form-item label="所在单位" prop="p_company">
                                <el-input v-model="reg_form.p_company"></el-input>
                            </el-form-item>
                        </el-col>
                        <el-col :span="8">
                            <el-form-item label="是否兼职" prop="p_parttime_job">
                                <el-radio-group v-model="reg_form.p_parttime_job">
                                    <el-radio label="是"></el-radio>
                                    <el-radio label="否"></el-radio>
                                </el-radio-group>
                            </el-form-item>
                        </el-col>
                    </el-row>

                    <el-row :gutter="20">
                        <el-col :span="12">
                            <el-form-item label="省市区" prop="selectedOptions">
                                <el-cascader :options="options" :props="props" v-model="reg_form.selectedOptions" style="width:400px;"></el-cascader>
                            </el-form-item>
                        </el-col>

                        <el-col :span="12">
                            <el-form-item label="电子邮箱" prop="p_email">
                                <el-input v-model="reg_form.p_email"></el-input>
                            </el-form-item>
                        </el-col>
                    </el-row>

                    <el-row>
                        <el-col :span="24">
                            <el-form-item label="通信地址" prop="address">
                                <el-input v-model="reg_form.address"></el-input>
                            </el-form-item>
                        </el-col>
                    </el-row>

                    <el-row :gutter="20">
                        <el-col :span="24">
                            <el-form-item label="工作简历" prop="p_resume">
                                <el-input type="textarea" v-model="reg_form.p_resume"></el-input>
                            </el-form-item>
                        </el-col>
                    </el-row>

                    <el-row :gutter="20">
                        <el-col :span="24">
                            <el-form-item label="志愿服务经历" prop="p_experience">
                                <el-input type="textarea" v-model="reg_form.p_experience"></el-input>
                            </el-form-item>
                        </el-col>
                    </el-row>

                    <el-row :gutter="20">
                        <el-col :span="24">
                            <el-form-item label="专业特长" prop="p_specialty">
                                <el-input type="textarea" v-model="reg_form.p_specialty"></el-input>
                            </el-form-item>
                        </el-col>
                    </el-row>

                    <el-row :gutter="20">
                        <el-col :span="24">
                            <el-form-item label="承诺内容" prop="p_promise">
                                <el-input type="textarea" v-model="reg_form.p_promise" disabled></el-input>
                            </el-form-item>
                        </el-col>
                    </el-row>

                    <el-row :gutter="20">
                        <el-col :span="24">
                            <el-form-item label="自愿提供的服务内容" prop="p_service_content">
                                <el-input type="textarea" v-model="reg_form.p_service_content"></el-input>
                            </el-form-item>
                        </el-col>
                    </el-row>

                </template>

                <el-form-item prop="phone">
                    <el-input v-model="reg_form.phone" style="width:300px;" :disabled="phone_status == 2" placeholder="请输入注册手机号"
                        @input="check_phone"></el-input>
                    <el-button disabled v-if=" phone_status == 2 ">{{ phone_second }}S重发</el-button>
                    <el-button :disabled=" phone_status == 0 " v-if=" phone_status < 2 " @click="get_phone_code()" type="primary">获取验证码</el-button>
                </el-form-item>
                <el-form-item v-if="code_sended" prop="phone_code">
                    <el-input v-model="reg_form.phone_code" style="width:300px;" type="number" placeholder="请输入验证码"></el-input>
                    <el-button disabled type="success" v-if=" reg_form.phone_code.length > 4 ">已填写</el-button>
                </el-form-item>

                <el-form-item>
                    <el-button type="primary" @click="do_reg('reg_form')" style="width:416px">提交注册</el-button>
                </el-form-item>
                <el-form-item prop="clause">
                    <el-checkbox-group v-model="reg_form.clause">
                        <el-checkbox name="clause">
                            我志愿加入“协税者”志愿服务团
                            <!-- <i v-if="!clause_open" class="el-icon-caret-bottom" @click="clause_open = true"></i>
                            <i v-if="clause_open" class="el-icon-caret-top" @click="clause_open = false"></i> -->
                        </el-checkbox>
                    </el-checkbox-group>
                    <div class="ml-4">
                        <div> <a :href="$url('index/cn_txt')" target="_blank">《志愿者承诺书》</a></div>
                        <div> <a :href="$url('index/guicheng_txt')" target="_blank">《志愿服务团规程（试行）》</a></div>
                    </div>
                </el-form-item>
            </el-form>
        </div>

    </div>
</template>

<script>
    var type = url('?type');

    var app_inside = {
        data: function () {
            return {
                props: {
                    label: 'name',
                    value: 'name',
                    children: 'children'
                },
                options: city_options,
                is_login: false,
                reg_form: {
                    p_name: '',
                    p_sex: '',
                    p_nationality: '',
                    p_education: '',
                    p_phone: '',
                    p_id_number: '',
                    p_company: '',
                    p_parttime_job: '',
                    p_major: '',
                    p_job: '',
                    p_wx: '',
                    p_email: '',
                    p_resume: '',
                    p_experience: '',
                    p_specialty: '',
                    p_service_content: '',
                    p_promise: '我志愿成为一名光荣的志愿者。我承诺：尽己所能，不计报酬，帮助他人，服务社会，践行志愿精神，传播先进文化，为社会主义税收事业贡献力量！',

                    c_name: '',
                    c_credit_code: '',
                    c_capital: '',
                    c_unit_type: '',
                    c_found_time: '',
                    c_email: '',

                    c_workers_number: '',
                    c_accounting_number: '',
                    c_customer_number: '',
                    c_lastyear_income: '',
                    c_service_income: '',
                    c_legal_person: '',
                    c_legal_person_idnumber: '',
                    c_legal_person_phone: '',
                    c_liaison_person: '',
                    c_liaison_person_phone: '',
                    c_liaison_person_wx: '',
                    c_regd: '',
                    c_regd_name: '',
                    c_business_range: '',
                    c_service_content: '',
                    c_promise: '我单位自愿加入“协税者”服务团志愿，现承诺：尽己所能，不计报酬，帮助他人，服务社会，践行志愿精神，传播先进文化，为社会主义税收事业贡献力量！',

                    selectedOptions: [],
                    province: '',
                    city: '',
                    area: '',
                    type: '',
                    address: '',
                    //联系方式
                    phone: '',
                    phone_code: '',
                    clause: [],
                },
                rules: {
                    selectedOptions: [
                        { type: 'array', required: true, message: '请选择省市区', trigger: 'change' }
                    ],
                    clause: [
                        { type: 'array', required: true, message: '请先同意服务条款', trigger: 'change' }
                    ],
                    type: [
                        { required: true, message: '请选择注册类型', trigger: 'change' }
                    ],
                    p_name: [
                        { required: true, message: '请输入姓名', trigger: 'change' }
                    ],
                    p_sex: [
                        { required: true, message: '请输入性别', trigger: 'change' }
                    ],
                    p_phone: [
                        { required: true, message: '请输入联系方式', trigger: 'change' }
                    ],
                    p_education: [
                        { required: true, message: '请输入教育程度', trigger: 'change' }
                    ],
                    p_id_number: [
                        { required: true, message: '请输入身份证号', trigger: 'change' }
                    ],
                    p_company: [
                        { required: true, message: '请输入所在单位', trigger: 'change' }
                    ],
                    p_parttime_job: [
                        { required: true, message: '请选择是否兼职', trigger: 'change' }
                    ],
                    p_promise: [
                        { required: true, message: '请填写承诺内容', trigger: 'change' }
                    ],
                    c_name: [
                        { required: true, message: '请输入单位名称', trigger: 'change' }
                    ],
                    c_capital: [
                        { required: true, message: '请输入注册资本', trigger: 'change' }
                    ],
                    address: [
                        { required: true, message: '请输入实际办公地址', trigger: 'change' }
                    ],
                    c_credit_code: [
                        { required: true, message: '请输入统一社会信用代码', trigger: 'change' }
                    ],
                    c_legal_person: [
                        { required: true, message: '请输入单位法人', trigger: 'change' }
                    ],
                    c_legal_person_idnumber: [
                        { required: true, message: '请输入单位身份证号', trigger: 'change' }
                    ],
                    c_legal_person_phone: [
                        { required: true, message: '请输入法人联系方式', trigger: 'change' }
                    ],
                    c_liaison_person: [
                        { required: true, message: '请输入服务团联络人', trigger: 'change' }
                    ],
                    c_liaison_person_phone: [
                        { required: true, message: '请输入服务团联络人联系方式', trigger: 'change' }
                    ],
                    c_liaison_person_wx: [
                        { required: true, message: '请输入服务团联络人微信', trigger: 'change' }
                    ],
                    // c_promise:[
                    //     { required: true, message: '请填写承诺内容', trigger: 'change' }
                    // ],

                    phone: [
                        { required: true, message: '请输入手机号', trigger: 'change' }
                    ],
                    phone_code: [
                        { required: true, message: '请输入手机验证码', trigger: 'change' }
                    ],
                },
                phone_status: 0,        // 0手机号不正确，1手机号正确，2已发送验证码
                phone_second: 60,
                code_sended: false,
                clause_open: false,
            }
        },
        created: function () {
            var _this = this;
            if (type) {
                _this.reg_form.type = type;
            } else {
                _this.reg_form.type = '1';
            }


        },
        methods: {
            change_type: function (type) {
                var _this = this;
                redirect(_this.$url('index/reg', {type: type}));
            },
            do_reg: function (form) {
                var _this = this,
                    _fields = Object.assign({}, _this.reg_form);
                _fields.province = _fields.selectedOptions[0];
                _fields.city = _fields.selectedOptions[1];
                _fields.area = _fields.selectedOptions[2];
                if (_fields.c_found_time > 0) {
                    _fields.c_found_time = _fields.c_found_time / 1000;
                }
                this.$refs[form].validate((valid) => {
                    if (valid) {
                        web.send('member_reg', _fields, function (res) {
                            _this.$message({
                                message: '注册成功',
                                type: 'success'
                            });
                            setTimeout(function () {
                                redirect(_this.$url('index/personal'));
                            }, 1000);
                        }, null, { loading_show: false });
                    } else {
                        _this.$message({
                            message: '请填写必填项',
                            type: 'warning'
                        });
                    }
                });
            },
            check_phone: function () {
                var _this = this;
                if (!(/^1[3456789]\d{9}$/.test(_this.reg_form.phone))) {
                    _this.phone_status = 0;
                    return false;
                }
                _this.phone_status = 1;
            },
            get_phone_code: function () {
                var _this = this;

                if (_this.phone_status == 2 && _this.phone_second < 60) {
                    layer.msg('手机号码有误');
                    return false;
                }
                web.send('send_phone_code', { phone: _this.reg_form.phone, type: 'reg' }, function (res) {
                    _this.$message({
                        message: '验证码已发送，10分钟有效',
                        type: 'success'
                    });
                    _this.code_sended = true;
                    _this.phone_second = 60;
                    _this.phone_timer = setInterval(function () {
                        if (_this.phone_second == 0) {
                            clearInterval(_this.phone_timer);
                            _this.phone_status = 1;
                        }
                        _this.phone_second--;
                    }, 1000);
                    _this.phone_status = 2;
                });
            },
        },

        template: '#app_inside'
    };
</script>